<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{shipper/layout}">
<head>
<meta charset="UTF-8">
<title>Nhân viên giao hàng - 4Petals</title>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
	<div layout:fragment="content">
		<div class="dashboard-container">
			<div class="main-content show">
				<div id="content-section" class="content-box mt-4 mx-3 p-4">
					<h5 class="fw-bold text-danger">Danh sách đơn hàng đang xử lý</h5>

					<div
						th:if="${successMessages != null and not #lists.isEmpty(successMessages)}"
						class="alert alert-success mt-3" role="alert">
						<div th:each="msg : ${successMessages}" th:text="${msg}"></div>
					</div>
					<div
						th:if="${errorMessages != null and not #lists.isEmpty(errorMessages)}"
						class="alert alert-danger mt-3" role="alert">
						<div th:each="msg : ${errorMessages}" th:text="${msg}"></div>
					</div>
					<form id="orderForm" th:action="@{/shipper/updateOrders}"
						method="post">
						<table class="table table-bordered mt-3 align-middle text-center">
							<thead class="table-success">
								<tr>
									<th>STT</th>
									<th>Mã đơn hàng</th>
									<th>Tên khách hàng</th>
									<th>Xem chi tiết</th>
									<th>Trạng thái</th>
									<th>Ghi chú</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="order, iStat : ${listOrders}">
									<td th:text="${iStat.count}"></td>
									<td th:text="${order.maDH}"></td>
									<td
										th:text="${order.khachHang != null ? order.khachHang.hoTen : 'Chưa có'}"></td>

									<td class="text-center"><a href="#"
										class="text-primary fs-5"
										th:onclick="'showOrderDetail(' + ${order.maDH} + '); return false;'">
											<i class="fa-solid fa-magnifying-glass"></i>
									</a></td>
									<td class="text-center"><select
										class="form-select form-select-sm text-center"
										th:id="'status-' + ${order.maDH}"
										th:name="'status-' + ${order.maDH}"
										onchange="kiemTraGhiChu(this)">
											<option value="DANG_GIAO"
												th:selected="${order.trangThai.name() == 'DANG_GIAO'}">Đang
												giao</option>
											<option value="HOAN_TAT"
												th:selected="${order.trangThai.name() == 'HOAN_TAT'}">Giao
												hàng thành công</option>
											<option value="HUY"
												th:selected="${order.trangThai.name() == 'HUY'}">Giao
												hàng thất bại</option>
									</select></td>

									<td class="text-center"><input type="text"
										class="form-control form-control-sm text-center"
										placeholder="Nhập ghi chú (nếu có)"
										th:id="'note-' + ${order.maDH}"
										th:name="'note-' + ${order.maDH}" th:value="${order.ghiChu}">
									</td>
								</tr>
							</tbody>
						</table>

						<div class="d-flex justify-content-end mt-3 gap-2">
							<button type="submit" class="btn btn-success px-4">
								<i class="fa-solid fa-floppy-disk me-1"></i> Lưu
							</button>
							<button type="button" class="btn btn-secondary px-4"
								id="btnCancel">
								<i class="fa-solid fa-xmark me-1"></i> Hủy
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<div
			class="toast-container position-fixed top-50 start-50 translate-middle p-3"
			style="z-index: 2000;">
			<div id="orderDetailToast"
				class="toast align-items-center text-bg-light border-0 shadow-lg"
				role="alert">
				<div class="toast-header bg-success text-white">
					<strong class="me-auto">Chi tiết đơn hàng</strong>
					<button type="button" class="btn-close btn-close-white"
						data-bs-dismiss="toast" aria-label="Close"></button>
				</div>
				<div class="toast-body">
					<table class="table table-striped mb-3">
						<tr>
							<th>Mã đơn hàng</th>
							<td id="maDH"></td>
						</tr>
						<tr>
							<th>Tên khách hàng</th>
							<td id="tenKhachHang"></td>
						</tr>
						<tr>
							<th>Địa chỉ</th>
							<td id="diaChi"></td>
						</tr>
						<tr>
							<th>Số điện thoại</th>
							<td id="soDienThoai"></td>
						</tr>
						<tr>
							<th>Sản phẩm</th>
							<td>
								<div id="sanPhamDetails"></div>
							</td>
						</tr>
						<tr>
							<th>Tổng tiền</th>
							<td id="thanhTien"></td>
						</tr>
						<tr>
							<th>Phương thức thanh toán</th>
							<td id="phuongThucThanhToan"></td>
						</tr>
						<tr>
							<th>Ghi chú</th>
							<td id="ghiChu"></td>
						</tr>
					</table>
					<div class="text-end">
						<button type="button" class="btn btn-secondary btn-sm"
							data-bs-dismiss="toast">Đóng</button>
					</div>
				</div>
			</div>
		</div>
		<style>
#orderDetailToast {
	width: 600px;
	max-width: 90vw;
	border-radius: 15px;
}

#orderDetailToast .toast-body {
	background-color: #fff;
	border-radius: 0 0 15px 15px;
}

#orderDetailToast th {
	width: 150px;
	color: #198754;
}
</style>
		<script type="text/javascript" th:src="@{/js/process.js}"></script>
		<script th:src="@{/styles/js/shipper/main.js}"></script>
	</div>
</body>
</html>