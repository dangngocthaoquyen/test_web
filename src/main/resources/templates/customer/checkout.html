<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{customer/layout}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thanh to√°n</title>

<th:block layout:fragment="styles">
	<link rel="stylesheet" href="/styles/css/customer/base.css">
	<link rel="stylesheet" href="/styles/css/customer/checkout.css">
</th:block>
</head>
<body>
	<div layout:fragment="content" class="checkout-container">

		<!-- üå∏ ====== ƒê·ªäA CH·ªà NH·∫¨N H√ÄNG ====== -->
		<section class="address-section">
			<div class="address-header">
				<i class="fa fa-location-dot"></i>
				<h3>ƒê·ªãa ch·ªâ nh·∫≠n h√†ng</h3>
			</div>

			<div class="address-info">
				<p class="receiver">
					<span class="name" id="selectedName"
						th:text="${defaultAddress != null ? defaultAddress.hoTen : 'Ch∆∞a ch·ªçn ng∆∞·ªùi nh·∫≠n'}"></span>
					(<span class="phone" id="selectedPhone"
						th:text="${defaultAddress != null ? defaultAddress.sdt : '---'}"></span>)
				</p>
				<p class="address" id="selectedAddress"
					th:text="${defaultAddress != null ? defaultAddress.diaChiChiTiet : 'Ch∆∞a c√≥ ƒë·ªãa ch·ªâ giao h√†ng'}"></p>

				<a href="#" class="change-btn"
					th:text="${defaultAddress != null ? 'Thay ƒë·ªïi' : '+ Th√™m ƒë·ªãa ch·ªâ'}"></a>
			</div>
		</section>

		<!-- üõí ====== DANH S√ÅCH S·∫¢N PH·∫®M ====== -->
		<section class="cart-section">
			<h3>S·∫£n ph·∫©m</h3>
			<table class="cart-table">
				<thead>
					<tr>
						<th>S·∫£n ph·∫©m</th>
						<th>ƒê∆°n gi√°</th>
						<th>S·ªë l∆∞·ª£ng</th>
						<th>Th√†nh ti·ªÅn</th>
					</tr>
				</thead>
				<tbody th:if="${cartItems != null}">
					<tr th:each="item : ${cartItems}">
						<td class="product-info"><img
							th:src="@{${item.sanPham.hinhAnh.startsWith('/uploads') ? item.sanPham.hinhAnh : '/uploads/product/' + item.sanPham.hinhAnh}}"
							alt="·∫¢nh s·∫£n ph·∫©m">
							<div class="p-name" th:text="${item.sanPham.tenSP}"></div></td>

						<td
							th:text="${#numbers.formatDecimal(item.sanPham.gia, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
						<td th:text="${item.soLuong}"></td>
						<td
							th:text="${#numbers.formatDecimal(item.tongTien, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
					</tr>
				</tbody>
			</table>
			<div class="cart-summary">
				<p>
					T·ªïng ti·ªÅn (<span th:text="${#lists.size(cartItems)}">0</span> s·∫£n
					ph·∫©m): <strong
						th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></strong>
				</p>
			</div>
		</section>


		<!-- üí≥ ====== PH∆Ø∆†NG TH·ª®C THANH TO√ÅN ====== -->
		<section class="payment-section">
			<h3>Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
			<div class="payment-options">

				<!-- COD -->
				<label class="payment-tab active"> <input type="radio"
					name="paymentMethod" value="COD" checked> <img
					src="/styles/image/icons/cash-on-delivery.png" alt="COD"
					class="payment-icon"> <span>Thanh to√°n khi nh·∫≠n h√†ng
						(Ship COD)</span>
				</label>

				<!-- MOMO -->
				<label class="payment-tab"> <input type="radio"
					name="paymentMethod" value="QR"> <img
					src="/styles/image/icons/momo.svg" alt="MoMo" class="payment-icon">
					<span>Thanh to√°n Online (MoMo)</span>
				</label>
			</div>

			<!-- üßæ ====== T·ªîNG K·∫æT & N√öT ƒê·∫∂T H√ÄNG ====== -->
			<div class="payment-summary">
				<div class="summary-line">
					<span>T·ªïng ti·ªÅn h√†ng</span> <span
						th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></span>
				</div>
				<div class="summary-line">
					<span>Ph√≠ v·∫≠n chuy·ªÉn</span> <span
						th:text="${#numbers.formatDecimal(shippingFee, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></span>
				</div>
				<div class="summary-line total">
					<span>T·ªïng thanh to√°n</span> <strong
						th:text="${grandTotal != null ? #numbers.formatDecimal(grandTotal.doubleValue(), 0, 'COMMA', 0, 'POINT') : '0'} + ' ‚Ç´'"></strong>
				</div>

				<form th:action="@{/checkout/confirm}" method="post"
					id="checkoutForm">
					<input type="hidden" name="tenNguoiNhan"
						th:value="${defaultAddress != null ? defaultAddress.hoTen : ''}">
					<input type="hidden" name="sdt"
						th:value="${defaultAddress != null ? defaultAddress.sdt : ''}">
					<input type="hidden" name="diaChi"
						th:value="${defaultAddress != null ? defaultAddress.diaChiChiTiet : ''}">
					<input type="hidden" name="productId" th:value="${param.productId}">
					<input type="hidden" name="quantity" th:value="${param.quantity}">
					<input type="hidden" name="paymentMethod" id="paymentMethodInput"
						value="COD">
					<button type="submit" class="btn-order">ƒê·∫∑t h√†ng</button>
				</form>
			</div>
		</section>



		<!-- üì¶ ====== POPUP ƒê·ªäA CH·ªà ====== -->
		<div id="addressModal" class="modal hidden">
			<div class="modal-content">
				<h3>ƒê·ªãa ch·ªâ c·ªßa t√¥i</h3>

				<div class="address-list">
					<!-- ‚úÖ N·∫øu c√≥ ƒë·ªãa ch·ªâ -->
					<div th:each="addr : ${addresses}" class="address-item">
						<label> <input type="radio" name="selectedAddress"
							th:value="${addr.maDC}" th:checked="${addr.macDinh}"
							th:attr="data-name=${addr.hoTen},
                    data-phone=${addr.sdt},
                    data-address=${addr.diaChiChiTiet}">
							<strong th:text="${addr.hoTen}"></strong> (<span
							th:text="${addr.sdt}"></span>)
						</label>
						<p th:text="${addr.diaChiChiTiet}"></p>
					</div>


					<!-- ‚ùå N·∫øu ch∆∞a c√≥ ƒë·ªãa ch·ªâ n√†o -->
					<div th:if="${#lists.isEmpty(addresses)}" class="no-address">
						<p>Hi·ªán b·∫°n ch∆∞a c√≥ ƒë·ªãa ch·ªâ giao h√†ng n√†o.</p>
						<p>Vui l√≤ng th√™m ƒë·ªãa ch·ªâ m·ªõi b√™n d∆∞·ªõi üå∏</p>
					</div>

					<!-- ‚ûï Form th√™m ƒë·ªãa ch·ªâ m·ªõi -->
					<button id="openAddFormBtn" class="add-new-btn">+ Th√™m ƒê·ªãa
						Ch·ªâ M·ªõi</button>
					<form id="addAddressForm" class="hidden" method="post"
						th:action="@{/account/address/add}">
						<div class="form-group">
							<label>H·ªç t√™n</label> <input type="text" name="hoTen" required>
						</div>
						<div class="form-group">
							<label>S·ªë ƒëi·ªán tho·∫°i</label> <input type="text" name="sdt"
								required>
						</div>
						<div class="form-group">
							<label>ƒê·ªãa ch·ªâ chi ti·∫øt</label>
							<textarea name="diaChiChiTiet" rows="3" required></textarea>
						</div>
						<button type="submit" class="confirm-btn">L∆∞u ƒë·ªãa ch·ªâ</button>
					</form>

					<div class="modal-actions">
						<button id="cancelAddressBtn">H·ªßy</button>
						<button id="confirmAddressBtn" class="confirm-btn">X√°c
							nh·∫≠n</button>
					</div>
				</div>
			</div>
		</div>

	</div>

	<th:block layout:fragment="scripts">
		<script src="/styles/js/customer/header.js"></script>
		<script src="/styles/js/customer/checkout.js"></script>
	</th:block>
</body>
</html>