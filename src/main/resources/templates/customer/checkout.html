<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{customer/layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh to√°n</title>

    <th:block layout:fragment="styles">
        <link rel="stylesheet" href="/styles/css/customer/base.css">
        <link rel="stylesheet" href="/styles/css/customer/checkout.css">
    </th:block>
</head>
<body>
<div layout:fragment="content" class="checkout-container">

    <!-- ====== ƒê·ªäA CH·ªà NH·∫¨N H√ÄNG ====== -->
    <section class="address-section">
        <div class="address-header">
            <i class="fa fa-location-dot"></i>
            <h3>ƒê·ªãa ch·ªâ nh·∫≠n h√†ng</h3>
        </div>
        <div class="address-info">
            <p class="receiver">
                <span class="name" th:text="${customer.hoTen}">Thu Trang</span>
                (<span class="phone" th:text="${customer.sdt}">0123654789</span>)
            </p>
            <p class="address" th:text="${customer.diaChi}">
                S·ªë 22C, L√†ng TƒÉng Ph√∫, P. TƒÉng Nh∆°n Ph√∫ A, TP. Th·ªß ƒê·ª©c
            </p>
            <a href="#" class="change-btn">Thay ƒë·ªïi</a>
        </div>
    </section>

    <!-- ====== DANH S√ÅCH S·∫¢N PH·∫®M ====== -->
    <section class="cart-section">
        <h3>S·∫£n ph·∫©m</h3>
        <table class="cart-table">
            <thead>
            <tr>
                <th>S·∫£n ph·∫©m</th>
                <th>ƒê∆°n gi√°</th>
                <th>S·ªë l∆∞·ª£ng</th>
                <th>Th√†nh ti·ªÅn</th>
            </tr>
            </thead>
            <tbody th:if="${cartItems != null}">
            <tr th:each="item : ${cartItems}">
                <td class="product-info">
                    <img th:src="@{/styles/image/product/{file}(file=${item.sanPham.hinhAnh})}" alt="·∫¢nh s·∫£n ph·∫©m">
                </td>
                <td class="p-name" th:text="${item.sanPham.tenSP}"></td>
                <td th:text="${#numbers.formatDecimal(item.sanPham.gia, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
                <td th:text="${item.soLuong}"></td>
                <td th:text="${#numbers.formatDecimal(item.tongTien, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
            </tr>
            </tbody>
        </table>
        <div class="cart-summary">
            <p>
                T·ªïng ti·ªÅn (<span th:text="${#lists.size(cartItems)}">0</span> s·∫£n ph·∫©m):
                <strong th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></strong>
            </p>
        </div>
    </section>

    <!-- ====== PH∆Ø∆†NG TH·ª®C THANH TO√ÅN ====== -->
    <section class="payment-section">
        <h3>Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
        <div class="payment-options">
            <label class="payment-tab active">
                <input type="radio" name="paymentMethod" value="COD" checked>
                <img src="/styles/image/icons/cod.png" alt="COD">
                <span>Thanh to√°n khi nh·∫≠n h√†ng (Ship COD)</span>
            </label>
            <label class="payment-tab">
                <input type="radio" name="paymentMethod" value="QR">
                <img src="/styles/image/icons/qr.png" alt="QR">
                <span>Thanh to√°n Online (Qu√©t m√£ QR)</span>
            </label>
        </div>

        <div class="qr-box" id="qrBox">
            <p>Vui l√≤ng qu√©t m√£ QR ƒë·ªÉ thanh to√°n:</p>
            <img src="/styles/image/payment/qr-demo.png" alt="QR">
            <p class="qr-note">Sau khi qu√©t, ƒë∆°n h√†ng s·∫Ω ƒë∆∞·ª£c x√°c nh·∫≠n t·ª± ƒë·ªông üå∏</p>
        </div>

        <!-- ====== T·ªîNG K·∫æT ====== -->
        <div class="payment-summary">
            <div class="summary-line">
                <span>T·ªïng ti·ªÅn h√†ng</span>
                <span th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></span>
            </div>
            <div class="summary-line">
                <span>Ph√≠ v·∫≠n chuy·ªÉn</span><span>20.000 ‚Ç´</span>
            </div>
            <div class="summary-line total">
                <span>T·ªïng thanh to√°n</span>
                <strong th:text="${#numbers.formatDecimal(total.doubleValue() + 20000, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></strong>
            </div>

            <form th:action="@{/checkout/confirm}" method="post">
                <input type="hidden" name="tenNguoiNhan" th:value="${customer.hoTen}">
                <input type="hidden" name="sdt" th:value="${customer.sdt}">
                <input type="hidden" name="diaChi" th:value="${customer.diaChi}">
                <input type="hidden" name="paymentMethod" id="paymentMethodInput" value="COD">
                <button type="submit" class="btn-order">ƒê·∫∑t h√†ng</button>
            </form>
        </div>
    </section>

    <!-- ====== POPUP ƒê·ªäA CH·ªà ====== -->
    <div id="addressModal" class="modal hidden">
        <div class="modal-content">
            <h3>ƒê·ªãa Ch·ªâ C·ªßa T√¥i</h3>

            <div class="address-list">

                <!-- ƒê·ªãa ch·ªâ m·∫∑c ƒë·ªãnh (customer) -->
                <div class="address-item">
                    <label>
                        <input type="radio" name="selectedAddress" value="customer" checked>
                        <strong th:text="${customer.hoTen}">T√™n kh√°ch h√†ng</strong>
                        (<span th:text="${customer.sdt}">SƒêT</span>)
                    </label>
                    <p th:text="${customer.diaChi}">ƒê·ªãa ch·ªâ m·∫∑c ƒë·ªãnh t·ª´ t√†i kho·∫£n</p>
                </div>

                <!-- ƒê·ªãa ch·ªâ ph·ª• t·ª´ b·∫£ng DiaChi -->
                <div th:each="addr : ${addresses}" class="address-item">
                    <label>
                        <input type="radio" name="selectedAddress" th:value="${addr.maDC}">
                        <strong th:text="${addr.hoTen}"></strong>
                        (<span th:text="${addr.sdt}"></span>)
                    </label>
                    <p th:text="${addr.diaChiChiTiet}"></p>
                </div>

                <!-- Form th√™m ƒë·ªãa ch·ªâ -->
                <button id="openAddFormBtn" class="add-new-btn">+ Th√™m ƒê·ªãa Ch·ªâ M·ªõi</button>
                <form id="addAddressForm" class="hidden" method="post" th:action="@{/address/add}">
                    <div class="form-group">
                        <label>H·ªç t√™n</label>
                        <input type="text" name="hoTen" required>
                    </div>
                    <div class="form-group">
                        <label>S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="text" name="sdt" required>
                    </div>
                    <div class="form-group">
                        <label>ƒê·ªãa ch·ªâ chi ti·∫øt</label>
                        <textarea name="diaChiChiTiet" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="confirm-btn">L∆∞u ƒë·ªãa ch·ªâ</button>
                </form>

                <div class="modal-actions">
                    <button id="cancelAddressBtn">H·ªßy</button>
                    <button id="confirmAddressBtn" class="confirm-btn">X√°c nh·∫≠n</button>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="scripts">
    <script src="/styles/js/customer/header.js"></script>
    <script th:src="@{/styles/js/customer/checkout.js}"></script>
</th:block>
</body>
</html>
