
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu·∫£n l√Ω kho - 4Petals</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link th:href="@{/styles/css/inventory/dashboard.css}" rel="stylesheet">
<link th:href="@{/styles/css/inventory/sidebar.css}" rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
<link
	href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap"
	rel="stylesheet">
<script>
        // H√†m ƒë·ªÉ t·∫£i danh s√°ch ƒë∆°n h√†ng b·∫±ng AJAX (thay ƒë·ªïi n·ªôi dung b·∫£ng)
        function showOrders() {
            fetch('/orders/list') // endpoint controller tr·∫£ v·ªÅ HTML ho·∫∑c JSON
                .then(response => response.text())
                .then(html => {
                    document.getElementById('content-section').innerHTML = html;
                });
        }

        function showProducts() {
            fetch('/products/list')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('content-section').innerHTML = html;
                });
        }
    </script>
</head>
<body>
	<div class="dashboard-container">

		<!-- Thanh b√™n tr√°i -->
		<div th:replace="~{inventory/sidebar :: sidebar}"></div>

		<!-- N·ªôi dung ch√≠nh -->
		<div class="main-content show">

			<!-- Ph·∫ßn hi·ªÉn th·ªã b·∫£ng -->
			<div id="content-section" class="content-box mt-4 mx-3 p-4">
				<h5 class="fw-bold text-danger">Danh s√°ch c√°c ƒë∆°n h√†ng c·∫ßn ƒë√≥ng
					g√≥i</h5>

				<table class="table table-bordered mt-3 align-middle text-center">
					<thead class="table-success">
						<tr>
							<th>STT</th>
							<th>M√£ ƒë∆°n h√†ng</th>
							<th>T√™n kh√°ch h√†ng</th>
							<th>Tr·∫°ng th√°i</th>
							<th>ƒê√≥ng g√≥i</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="order, iStat : ${listOrders}">
							<td th:text="${iStat.count}"></td>
							<td th:text="${order.maDH}"></td>
							<td
								th:text="${order.khachHang != null ? order.khachHang.hoTen : 'Ch∆∞a c√≥'}"></td>

							<!-- C·ªôt tr·∫°ng th√°i (checkbox) -->
							<td class="text-center"><input type="checkbox"
								th:id="'status-' + ${order.maDH}" disabled></td>

							<!-- C·ªôt ƒë√≥ng g√≥i (icon) -->
							<td class="text-center"><a href="#"
								class="text-primary fs-5"
								th:onclick="'showOrderDetail(' + ${order.maDH} + '); return false;'">
									üì¶ </a></td>
						</tr>
					</tbody>
				</table>
			</div>
			<!-- Modal hi·ªÉn th·ªã chi ti·∫øt ƒë∆°n h√†ng -->
			<div class="modal fade" id="orderDetailModal" tabindex="-1" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Chi ti·∫øt ƒë∆°n h√†ng</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body">
							<table class="table table-bordered">
								<thead>
									<tr>
										<th>STT</th>
										<th>T√™n s·∫£n ph·∫©m</th>
										<th>S·ªë l∆∞·ª£ng</th>
										<th>Gi√°</th>
										<th>Th√†nh ti·ªÅn</th>
									</tr>
								</thead>
								<tbody id="order-detail-body">
									<!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c fill b·∫±ng JS/AJAX -->
								</tbody>
							</table>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-success" onclick="confirmOrder()">X√°c nh·∫≠n</button>
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>

	<!-- JS Bootstrap -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<!-- JavaScript x·ª≠ l√Ω modal v√† x√°c nh·∫≠n -->
	<script>
	let currentOrderId = null;

	function showOrderDetail(maDH) {
		currentOrderId = maDH;

		// G·ªçi AJAX ƒë·ªÉ l·∫•y chi ti·∫øt ƒë∆°n h√†ng
		fetch('/orders/' + maDH + '/details') // endpoint tr·∫£ v·ªÅ JSON
			.then(response => response.json())
			.then(data => {
				const tbody = document.getElementById('order-detail-body');
				tbody.innerHTML = ''; // x√≥a c≈©
				data.forEach((item, index) => {
					const row = document.createElement('tr');
					row.innerHTML = `
						<td>${index + 1}</td>
						<td>${item.tenSP}</td>
						<td>${item.soLuong}</td>
						<td>${item.gia}</td>
						<td>${item.soLuong * item.gia}</td>
					`;
					tbody.appendChild(row);
				});

				// Hi·ªÉn th·ªã modal
				const modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
				modal.show();
			});
	}

	function confirmOrder() {
		if (currentOrderId !== null) {
			// T√≠ch √¥ tr·∫°ng th√°i
			const checkbox = document.getElementById('status-' + currentOrderId);
			checkbox.checked = true;

			// G·ª≠i AJAX ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i Order tr√™n server
			fetch('/orders/' + currentOrderId + '/confirm', { method: 'POST' });

			// ·∫®n modal
			const modalEl = document.getElementById('orderDetailModal');
			const modal = bootstrap.Modal.getInstance(modalEl);
			modal.hide();
		}
	}
	</script>
</body>
</html>
